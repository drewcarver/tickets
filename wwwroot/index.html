<!DOCTYPE html>
  <head>
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>
    <script src="https://cdn.auth0.com/js/auth0/9.18/auth0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <style>
  *, html {
    font-family: "Roboto", arial, san-serif;
  }

  body {
    display: flex; 
    min-height: 100vh;
    margin: 0;
  }

  nav {
    min-width: 10rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  main {
    background-color: #F1F1F1;
    display: flex;
    flex-direction: column;
    padding: 0 1rem;
    overflow: auto;
    max-height: 100vh;
  }

  header {
    background-color: blue;
    border-radius: 0 0 15px 0;
    min-height: 4rem;
  }
  .main-menu {
    border-radius: 0 15px 0 0;
    background-color: blue;
    flex: 1 auto;
    margin: 0;
  }
  
  .swimlanes {
    display: flex;
  }

  .swimlanes__lane {
    width: 25%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 0 10px;
    border-right: 1px lightgray solid;
  }
  
  .swimlane-titles {
    display: flex;
  }

  .swimlane-titles h2 {
    padding-left: 8px;
    width: 25%;
  }

  .card {
    background-color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    padding: 20px;
  }

  .card:hover {
    transform: scale(1.05);
    transition: .25s;
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
    cursor: pointer;
  }

    </style>
  </head>
  <body>
    <nav>
      <header>
        <span>Logo</span>
        <span>Add</span>
        <span>Menu</span>
      </header>
      <div class="main-menu">
        <span>Avatar</span>
        <ul>
          <li>Backlog</li>
          <li>Reports</li>
          <li>Releases</li>
          <li>Components</li>
          <li>Issues</li>
        </ul>
      </div>  
    </nav>
    <main>
      <h1>Board</h1>
      <div>
        <input placeholder="Search" />
        <select>
          <option>Quick Filters</option>
        </select>
      </div>
      <div class="swimlane-titles">
        <h2>Ready</h2>
        <h2>In Progress</h2>
        <h2>Testing</h2>
        <h2>Done</h2>
      </div>
      <div class="swimlanes">
        <div class="swimlanes__lane">
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
        </div>
        <div class="swimlanes__lane">
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
        </div>
        <div class="swimlanes__lane">
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
        </div>
        <div class="swimlanes__lane">
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
          <div class="card">
            <h3>Create a Ticket App</h2>
            <p>Need to create a ticket app for my presentation.</p>
            <p>Assignee: Drew</p>
          </div>
        </div>
      </div>
      <div>
      </div>
    </main>
  </body>
  <script>
    const clientID = 'kRYFKmwQiKoGQegrMTTmwRpgHoRZaByz';
    const domain = 'dev-fu83rki86r8dd5bd.us.auth0.com'
    const webAuth = new auth0.WebAuth({
      domain,
      clientID,
      audience: 'Todo API',
      responseType: 'token',
      redirectUri: 'http://localhost:5000/authorize.html'
    })
    const authToken = sessionStorage.getItem("access_token")

    const login = () => {
      webAuth.authorize()
    }

    const logout = () => {
      sessionStorage.removeItem('access_token')
      webAuth.logout({ returnTo: 'http://localhost:5000', clientID });
    }

    const checkSession = () => new Promise((resolve, reject) =>
      webAuth.checkSession({ audience: 'Todo API' }, function (err, authResult) {
          if (err)
          reject(err)
          else
          resolve(authResult)
      }))

    function isTokenExpired(token) {
      const decodedToken = JSON.parse(atob(token.split('.')[1]));
      const expirationTime = decodedToken.exp * 1000; // Convert expiration time to milliseconds

      return Date.now() >= expirationTime;
    }


    document.body.addEventListener("htmx:confirm", (e) => {
      const authToken = sessionStorage.getItem('access_token')
      if(!authToken || isTokenExpired(authToken)) {
        e.preventDefault() 

        webAuth.checkSession()
          .then(token => sessionStorage.setItem('access_token', token))
          .then(() => e.detail.issueRequest()) 
          .catch(() => login())
      }
    })

    document.body.addEventListener('htmx:configRequest', function(evt) {
      const authToken = sessionStorage.getItem("access_token")

      evt.detail.headers['Authorization'] = `Bearer ${authToken}` // add a new parameter into the mix
    });
  </script>
</html>
